# 菜谱食材手动输入功能

## 功能说明

在菜谱编辑页面，用户现在可以选择两种方式添加食材：
1. **从冰箱选择**：从已有的冰箱食材中选择
2. **手动输入**：直接输入食材名称、数量和单位

## 使用方法

### 添加食材

在菜谱编辑页面的"所需食材"部分，点击右上角的按钮：

- **手动输入**：添加一个可以自由输入的食材行
  - 食材名称：输入食材名称（例如：鸡蛋）
  - 数量：输入数量（例如：2）
  - 单位：输入单位（例如：个）

- **从冰箱选择**：添加一个从冰箱食材库选择的食材行
  - 从下拉列表中选择已有的食材
  - 输入数量

### 编辑和删除

- 每个食材行右侧都有删除按钮，点击即可删除该食材
- 可以随时修改食材的数量和单位

## 部署步骤

### 1. 执行数据库迁移

在使用此功能前，需要先执行数据库迁移，为 `kc_recipe_ingredients` 表添加 `name` 字段。

详细步骤请参考：`supabase/EXECUTE_RECIPE_INGREDIENT_NAME_MIGRATION.md`

### 2. 部署代码

确保以下文件已更新：
- `types.ts` - 添加了 `isManual` 字段
- `pages/Recipes.tsx` - 添加了手动输入界面
- `lib/adapters.ts` - 更新了数据转换逻辑

## 技术实现

### 1. 数据库结构修改

添加了 `name` 字段到 `kc_recipe_ingredients` 表：

```sql
ALTER TABLE kc_recipe_ingredients 
ADD COLUMN IF NOT EXISTS name VARCHAR(100);
```

### 2. 类型定义修改 (types.ts)

```typescript
export interface RecipeIngredient {
  ingredientId: string; // 关联冰箱食材的ID，如果是手动输入则为空字符串
  amount: number;
  name?: string; // 食材名称（从数据库获取或手动输入）
  unit?: string; // 食材单位（从数据库获取或手动输入）
  isManual?: boolean; // 是否为手动输入的食材
}
```

### 3. 界面实现 (pages/Recipes.tsx)

- 添加了两个按钮："手动输入"和"从冰箱选择"
- 根据 `isManual` 标志显示不同的输入界面：
  - 手动输入：显示三个输入框（名称、数量、单位）
  - 从冰箱选择：显示下拉选择框和数量输入框

### 4. 数据转换 (lib/adapters.ts)

**保存到数据库：**
```typescript
export function fromRecipeIngredients(recipe: any) {
  return recipe.ingredients.map((ing: any) => ({
    recipe_id: recipe.id,
    ingredient_id: ing.ingredientId || null,
    quantity: ing.amount,
    unit: ing.unit || '',
    optional: false,
    name: ing.isManual ? ing.name : null,
  }));
}
```

**从数据库读取：**
```typescript
ingredients: dbIngredients.map((ing: any) => ({
  ingredientId: ing.ingredient_id || '',
  amount: ing.quantity,
  name: ing.name || ing.kc_ingredients?.name || '',
  unit: ing.unit || ing.kc_ingredients?.unit || '',
  isManual: !ing.ingredient_id,
}))
```

## 优势

1. **灵活性**：不需要先在冰箱中添加食材，就可以创建菜谱
2. **快速创建**：可以快速输入食材信息，无需切换页面
3. **兼容性**：保持与现有冰箱食材系统的兼容性
4. **用户友好**：提供两种方式，满足不同场景的需求

## 注意事项

- 手动输入的食材不会自动添加到冰箱中
- 手动输入的食材在菜谱预览和烹饪页面中正常显示
- 建议在输入单位时使用常见的单位（如：克、个、勺、杯等）
- **重要**：必须先执行数据库迁移，否则保存菜谱时会失败
