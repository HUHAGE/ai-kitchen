# 菜谱食材手动输入修改

## 修改概述

将菜谱页面的所有食材改为手动输入，不再与冰箱食材关联。导入菜谱时，食材也不会自动添加到冰箱。

## 修改内容

### 1. 前端页面修改 (pages/Recipes.tsx)

**修改前：**
- 提供两个按钮："手动输入" 和 "从冰箱选择"
- 根据 `isManual` 标志显示不同的输入界面
- 从冰箱选择时，使用下拉框选择已有食材

**修改后：**
- 只提供一个 "添加食材" 按钮
- 所有食材都使用手动输入模式
- 输入字段：食材名称、数量、单位
- 移除了与冰箱食材的关联逻辑
- 所有新添加的食材自动设置 `isManual: true`

### 2. 导入服务修改 (services/recipeImport.service.ts)

**修改前：**
- 导入菜谱时，自动查找或创建冰箱食材
- 如果食材不存在，会自动创建到冰箱（数量为0）
- 菜谱食材通过 `ingredient_id` 关联到冰箱食材
- 显示警告信息："自动创建了新食材: xxx (数量为0，需要补货)"

**修改后：**
- 导入菜谱时，直接使用手动输入模式
- 不再查找或创建冰箱食材
- 食材信息直接保存在 `kc_recipe_ingredients` 表的 `name` 字段
- `ingredient_id` 设置为 `null`
- 移除了自动创建食材的警告信息

### 3. 数据类型修改 (services/recipes.service.ts)

**修改：**
- `RecipeIngredientInsert` 接口添加 `name` 字段
- 支持手动输入的食材名称
```typescript
export interface RecipeIngredientInsert {
  recipe_id: string;
  ingredient_id?: string | null;
  quantity: number;
  unit: string;
  optional?: boolean;
  name?: string | null; // 手动输入的食材名称
}
```

### 4. 数据适配器修改 (lib/adapters.ts)

**修改：**
- `fromRecipeIngredients` 函数更新逻辑
- 手动输入时：`ingredient_id` 为 `null`，`name` 保存食材名称
- 确保数据正确转换到数据库格式
```typescript
export function fromRecipeIngredients(recipe: any) {
  return recipe.ingredients.map((ing: any) => ({
    recipe_id: recipe.id,
    ingredient_id: ing.isManual ? null : (ing.ingredientId || null),
    quantity: ing.amount,
    unit: ing.unit || '',
    optional: false,
    name: ing.isManual ? ing.name : null,
  }));
}
```

### 5. 库存扣减逻辑修改 (store.tsx)

**修改：**
- `deductStock` 函数只处理关联了冰箱食材的项
- 手动输入的食材（`isManual: true`）不会尝试扣减库存
- 如果菜谱没有关联冰箱的食材，直接返回成功

### 6. 烹饪页面修改 (pages/Cooking.tsx)

**修改：**
- 完成烹饪的提示文字改为："制作完成，尽情享受美味吧！"
- 移除了"食材库存已自动更新"的提示

### 7. 计划页面修改 (pages/MealPlanner.tsx)

**修改：**
- 库存检查只针对关联了冰箱的食材
- 手动输入的食材不会显示缺货提示

### 8. 首页推荐逻辑修改 (pages/Dashboard.tsx)

**修改：**
- "食材齐全"推荐：只检查关联了冰箱的食材
- "拯救临期食材"推荐：只检查关联了冰箱的食材
- 如果菜谱没有关联冰箱的食材，不会出现在这些推荐中

## 数据库支持

数据库已经支持手动输入的食材：
- `kc_recipe_ingredients` 表有 `name` 字段（VARCHAR(100)）
- `ingredient_id` 可以为 `NULL`
- 有检查约束确保 `ingredient_id` 或 `name` 至少有一个不为空

## 用户体验改进

1. **简化操作**：不需要先在冰箱中添加食材，直接在菜谱中输入即可
2. **更灵活**：可以输入任意食材名称和单位，不受冰箱食材限制
3. **独立管理**：菜谱和冰箱完全独立，互不影响

## 注意事项

1. 现有的菜谱数据不受影响，仍然可以正常显示
2. 如果之前有关联冰箱食材的菜谱，仍然会显示食材名称（从 `kc_ingredients` 表获取）
3. 新创建或编辑的菜谱，所有食材都将使用手动输入模式

## 测试建议

1. 创建新菜谱，添加食材，保存后查看是否正确显示
2. 编辑现有菜谱，修改食材信息，确认保存成功
3. 导入菜谱，验证食材是否正确解析和保存
4. 查看菜谱详情页，确认食材显示正常
